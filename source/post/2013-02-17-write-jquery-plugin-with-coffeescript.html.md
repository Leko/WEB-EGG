---
path: /post/write-jquery-plugin-with-coffeescript/
title: CoffeeScriptでjQueryプラグインを書いてみて思ったこと
date: 2013-02-17T18:14:37+00:00
twitter_id:
  - "303072641877684225"
dsq_thread_id:
  - "3132332451"
image: /images/2013/02/20130217_eye11-604x244.jpg
categories:
  - 考えてみた
tags:
  - CoffeeScript
  - JavaScript
  - jQuery
---

こんにちは。  
昼夜逆転が一周してやっと普通の生活に戻って来ました。れこです

最近、CoffeeScript という JavaScript のライブラリにハマっています。  
半年前くらいに流行った、賛否両論な js ライブラリです。  
非常にシンプルに js を書くことができて、Ruby on Rails でも公式採用されています。  
その CoffeeScript で jQuery のプラグインを１つ書いてみて、CoffeeScript で開発していくことについて感じたことをメモします。

CoffeeScript や jQuery プラグインの基礎については特に触れません。ご了承下さい。

<!--more-->

## CoffeeScript とは

CoffeeScript は JavaScript を楽にシンプルに書けるライブラリです。おおまかな特徴は、

1. 文法は Ruby や Python に近い
2. 関数呼び出しの際に引数の括弧を省略できる
3. インデントでループや関数などのブロックを表現する
4. 行末のセミコロンやオブジェクトのリテラルなども省略可能
5. 従来の js では扱えない拡張された文法がもろもろ

など、素の js では考えられないほどタイプ数が減ります。  
そのため、コーディング速度や保守性が高まり、複数人で書いても品質の高く統一されたコードを書くことができます。

## 作ったもの

あまり簡素なものでは練習にならないので、今回は、[jQuery.masonry]のような要素をタイル状に並べるプラグインを作りました。  
ページの横幅からはみ出さないように横に並べる個数を調整できます。  
完成品を見てもらったほうが早いのでデモを。

[ページ内の要素をタイル上に並べる jQuery プラグイン jQuery.Tile.js]

プラグインに少し上乗せして、私の Twitter のつぶやきを表示しています。  
プラグインとは無関係に、一番下までスクロールすると、次のツイートを読み込む無限スクロールも入れてあります。  
余計なもの盛り込みました。はい。

## Coffee 版 jQuery プラグインのテンプレート

普通の js で jQuery プラグインを作ると、だいたいこのような感じになると思います。

```javascript
(function($) {
  $.fn.pluginName = function(config) {
    var defaults = {
      option: "オプション"
    };
    option = $.extend(defaults, config);
    return this.each(function() {
      // ここにプラグインの処理を書く
    });
  };
})(jQuery);
```

すごく、カッコカッコしています。

- コードを書き換えた時に、カッコの対応がズレる
- オブジェクトや配列を書くときに、最後の要素にもカンマを入れちゃう

など、しょうもないミスを頻発している私は、基本的な文法にもイライラします。  
ただ初心者なだけですね。はい。  
で、これを CoffeeScript で書くと、こうなります。

```coffeescript
do ($=jQuery) ->
  $.fn.pluginName = (config) ->
    defaults option: "オプション"
    option = $.extend(defaults, config)
    @.each ->
      # ここに処理を記述
```

**非常にシンプル**です。  
ループや関数の終わりはインデントで表現されるため、閉じカッコが不要です。  
そのため、非常にシンプルに書くことができます。  
こっちのほうが書きやすい！ 見やすい！ とおもいます。

## 感想、反省

ざっとプラグインを作ってみて思ったことをまとめると、以下の通りです。

### Coffee に使われている

今回のプラグインではかなり無理やり CoffeeScript の class を使った感がありました。  
class を使いこなせていないし、並びにオブジェクト指向への理解がまだ足りないと感じました。

### 設計ミス

また、html に要素を追加した際に、再描画を行うメソッドを用意しておらず、再度プラグインを呼び出すという記述になってしまっています。  
そして、今の実装方法だと、横幅の違う要素があるときれいに並びません。

### 感想

- もっと大規模の js じゃないと真価を発揮できなさそう
- でもすごく書きやすい
- js が多少分ければすぐに書けるようになる

js での面倒な書き方などを上手いこと包み込んでくれています。  
なので、書く側はロジックに集中でき、精神衛生上すごく優しいと感じました。

### 注意点

ただし、CoffeeScript は js の面倒は見てくれるけれど、書き手のロジックまでは面倒を見てくれませんので、結局**ウンコードはウンコードのまま**です。

## まとめ

Q,今後も CoffeeScript を使いますか？  
**A,使いたいけど、タイミングがあまり無さそう。**  
js はファイル数増えると読み込み速度が下がるので、結合コンパイルとかは非常にいいと思うのですが、既に js で書かれているファイルと Coffee の連結は都合が悪く**一から CoffeeScript100％で書かないと威力を発揮しにくい**と感じました。  
とは言え、使えるタイミングではとことん使えると思うので、機会があったらガンガン使っていこうと思います。

今回の記事で掲載したプラグインは Github に公開してあります。  
https://github.com/Leko/jquery.tile.js  
まだ実用的では無いので、プラグインの紹介記事はプラグインの修正後に公開します。  
最後まで読んで下さいまして、ありがとうございました。
