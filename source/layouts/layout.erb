<%= partial 'partials/google_tagmanager' -%>
<%= partial 'partials/google_font' -%>
<%= partial 'partials/google_adsense' -%>
<%= partial 'partials/disqus' -%>
<%= partial 'partials/fontawesome' -%>
<%= partial 'partials/load_css' -%>
<!doctype html>
<html>
  <head>
    <%= yield_content :head_opened %>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title><% if current_article.present? -%><%= current_article.title -%> | <% elsif defined?(tagname).present? -%>タグ：<%= tagname -%> | <% end %><%= config[:meta][:sitename] -%></title>
    <%= feed_tag :atom, "#{blog.options.prefix.to_s}/feed.xml", title: "Atom Feed" %>

    <% if defined?(tagname).present? # List of articles group by tag %>
      <%= partial 'partials/google_linked_data', locals: {linked_data: google_linked_data_tag(tagname, page_number)} %>

    <% elsif current_article.present? # One of article %>
      <link rel="canonical" href="<%= config[:meta][:siteurl] %><%= current_article.data.path %>" />
      <%= partial 'partials/ogp', locals: { article: current_article } %>
      <%= partial 'partials/twitter_card', locals: { article: current_article } %>
      <%= partial 'partials/google_linked_data', locals: {linked_data: google_linked_data_article(current_article)} %>

    <% elsif defined?(page_number).present? # List of articles %>
      <%= partial 'partials/google_linked_data', locals: {linked_data: google_linked_data_list(current_page, page_number)} %>
    <% end %>

    <%= preload_stylesheet_link_tag 'all', 'highlighting', rel: 'preload', as: 'style', onload: "this.rel='stylesheet'" %>
    <%= yield_content :stylesheets %>
    <%= yield_content :head_close %>
  </head>
  <body>
    <%= yield_content :body_opened %>
    <%= partial 'partials/navbar' %>
    <div class="container-fluid">
      <div class="row justify-content-center">
        <div class="col-xl-10">
          <div role="main">
            <%= yield_content :breadcrumb %>
            <div class="row">
              <div class="col-sm-9">
                <%= yield %>
              </div>
              <div class="col-sm-3 sidebar">
                <div class="card">
                  <header class="card__header">
                    <h2>Author</h2>
                  </header>
                  <section class="card__body">
                    <aside>
                      <div class="row justify-content-center">
                        <div class="col-sm-4">
                          <img src="<%= avatar_url %>" class="avatar" />
                        </div>
                        <div class="col-sm-8">
                          <strong><%= config[:meta][:author] %></strong>
                          <p class="bio"><%= config[:meta][:bio] %></p>
                          <ul class="social-accounts row justify-content-between">
                            <li class="col social-accounts__item social-accounts__item--twitter">
                              <a href="https://twitter.com/<%= config[:meta][:twitter] %>" target="_blank">
                                <i class="fa fa-twitter"></i>
                              </a>
                            </li>
                            <li class="col social-accounts__item social-accounts__item--facebook">
                              <a href="https://facebook.com/<%= config[:meta][:facebook] %>" target="_blank">
                                <i class="fa fa-facebook"></i>
                              </a>
                            </li>
                            <li class="col social-accounts__item social-accounts__item--github">
                              <a href="https://github.com/<%= config[:meta][:github] %>" target="_blank">
                                <i class="fa fa-github"></i>
                              </a>
                            </li>
                            <li class="col social-accounts__item social-accounts__item--qiita">
                              <a href="http://qiita.com/<%= config[:meta][:qiita] %>" target="_blank">
                                <span class="fa-stack">
                                  <i class="fa fa-square fa-stack-2x"></i>
                                  <i class="fa fa-search fa-stack-1x fa-inverse fa-2x"></i>
                                </span>
                              </a>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </aside>
                  </section>
                </div>
                <div class="card">
                  <header class="card__header">
                    <h2>Tags</h2>
                  </header>
                  <section class="card__body">
                    <aside>
                      <% tags = blog.tags.sort_by{|tag, articles| articles.size}.reverse %>
                      <ul class="post__tags">
                        <% tags.first(20).each do |tag, articles| %>
                          <li>
                            <%= link_to "#{tag} (#{articles.size})", tag_path(tag), :class => 'post__tags__tag' %>
                          </li>
                        <% end %>
                      </ul>
                      <details>
                        <summary class="summary__title">Show all tags</summary>
                        <ul class="post__tags">
                          <% tags.slice(20..-1).each do |tag, articles| %>
                            <li>
                              <%= link_to "#{tag} (#{articles.size})", tag_path(tag), :class => 'post__tags__tag' %>
                            </li>
                          <% end %>
                        </ul>
                      </details>
                    </aside>
                  </section>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <%= partial 'partials/footer' %>
    <%= yield_content :scripts %>
    <%= javascript_include_tag 'main', async: 'async' %>
    <%= yield_content :body_close %>
  </body>
</html>
